<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Video Chat App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .video-container {
                grid-template-columns: 1fr;
            }
        }

        .video-wrapper {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        input {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .info-box {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Global Video Chat</h1>
        <p class="subtitle">Connect with anyone, anywhere in the world</p>

        <div id="status" class="status info">
            Ready to start. Create a room or join an existing one.
        </div>

        <div class="video-container">
            <div class="video-wrapper">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="video-label">You</div>
            </div>
            <div class="video-wrapper">
                <video id="remoteVideo" autoplay playsinline></video>
                <div class="video-label">Remote User</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <input type="text" id="roomId" placeholder="Enter Room ID (e.g., room123)">
                <button class="btn-primary" onclick="createRoom()">Create Room</button>
                <button class="btn-success" onclick="joinRoom()">Join Room</button>
            </div>

            <div class="button-grid">
                <button class="btn-secondary" id="toggleVideo" onclick="toggleVideo()">Turn Off Video</button>
                <button class="btn-secondary" id="toggleAudio" onclick="toggleAudio()">Mute Audio</button>
                <button class="btn-danger" onclick="hangUp()" disabled id="hangupBtn">End Call</button>
            </div>
        </div>

        <div class="info-box">
            <h3>How to Use:</h3>
            <p><strong>1. Create a Room:</strong> Enter a room name and click "Create Room". Share this room ID with the person you want to call.</p>
            <p><strong>2. Join a Room:</strong> Enter the same room ID and click "Join Room" to connect.</p>
            <p><strong>3. Start Chatting:</strong> Once connected, you can see and hear each other!</p>
            <p><strong>Note:</strong> Both users need to be in the same room to connect. This demo uses a simple signaling method - for production, you'll need a proper signaling server.</p>
        </div>

        <div class="info-box" style="margin-top: 15px; background: #fef3c7; border-left: 4px solid #f59e0b;">
            <h3 style="color: #f59e0b;">‚ö†Ô∏è Important Setup Required:</h3>
            <p style="color: #92400e;"><strong>This demo requires a signaling server to work.</strong> The code below includes a simple peer-to-peer connection setup, but for real-world use across different networks and countries, you need:</p>
            <p style="color: #92400e;">1. A WebSocket signaling server (Node.js/Socket.io)</p>
            <p style="color: #92400e;">2. TURN/STUN servers for NAT traversal</p>
            <p style="color: #92400e;">3. HTTPS (required for camera/mic access)</p>
        </div>
    </div>

    <script>
        // WebRTC Configuration
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        let localStream;
        let remoteStream;
        let peerConnection;
        let roomId;
        let isVideoEnabled = true;
        let isAudioEnabled = true;

        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const statusDiv = document.getElementById('status');
        const roomInput = document.getElementById('roomId');
        const hangupBtn = document.getElementById('hangupBtn');

        // Initialize local media
        async function initLocalStream() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                });
                localVideo.srcObject = localStream;
                updateStatus('Camera and microphone ready!', 'success');
                return true;
            } catch (error) {
                updateStatus('Error accessing camera/microphone: ' + error.message, 'error');
                console.error('Error accessing media devices:', error);
                return false;
            }
        }

        // Create room
        async function createRoom() {
            roomId = roomInput.value.trim();
            if (!roomId) {
                updateStatus('Please enter a room ID', 'error');
                return;
            }

            if (!localStream) {
                const success = await initLocalStream();
                if (!success) return;
            }

            updateStatus(`Room "${roomId}" created! Share this ID with others to join.`, 'success');
            hangupBtn.disabled = false;
            
            // In a real app, you would send this to a signaling server
            console.log('Room created:', roomId);
        }

        // Join room
        async function joinRoom() {
            roomId = roomInput.value.trim();
            if (!roomId) {
                updateStatus('Please enter a room ID', 'error');
                return;
            }

            if (!localStream) {
                const success = await initLocalStream();
                if (!success) return;
            }

            updateStatus(`Joining room "${roomId}"...`, 'info');
            
            // Initialize peer connection
            await createPeerConnection();
            
            // Create offer
            try {
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                updateStatus('Waiting for remote peer...', 'info');
                hangupBtn.disabled = false;
                
                // In a real app, send offer to signaling server
                console.log('Offer created:', offer);
                
                // Show the offer for manual exchange (for demo purposes)
                displayOffer(offer);
                
            } catch (error) {
                updateStatus('Error creating connection: ' + error.message, 'error');
            }
        }

        // Create peer connection
        async function createPeerConnection() {
            peerConnection = new RTCPeerConnection(configuration);

            // Add local stream tracks to peer connection
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });

            // Handle incoming streams
            peerConnection.ontrack = (event) => {
                if (event.streams && event.streams[0]) {
                    remoteVideo.srcObject = event.streams[0];
                    updateStatus('Connected! You can now see each other.', 'success');
                }
            };

            // Handle ICE candidates
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    // In a real app, send candidate to signaling server
                    console.log('ICE candidate:', event.candidate);
                }
            };

            // Handle connection state changes
            peerConnection.onconnectionstatechange = () => {
                console.log('Connection state:', peerConnection.connectionState);
                if (peerConnection.connectionState === 'connected') {
                    updateStatus('Connected successfully!', 'success');
                } else if (peerConnection.connectionState === 'disconnected') {
                    updateStatus('Disconnected', 'error');
                }
            };
        }

        // Display offer (for demo - manual exchange)
        function displayOffer(offer) {
            console.log('Share this offer with the remote peer:');
            console.log(JSON.stringify(offer));
            alert('Check the browser console for the offer to share. In a real app, this would be sent automatically via a signaling server.');
        }

        // Toggle video
        function toggleVideo() {
            if (localStream) {
                isVideoEnabled = !isVideoEnabled;
                localStream.getVideoTracks()[0].enabled = isVideoEnabled;
                document.getElementById('toggleVideo').textContent = 
                    isVideoEnabled ? 'Turn Off Video' : 'Turn On Video';
            }
        }

        // Toggle audio
        function toggleAudio() {
            if (localStream) {
                isAudioEnabled = !isAudioEnabled;
                localStream.getAudioTracks()[0].enabled = isAudioEnabled;
                document.getElementById('toggleAudio').textContent = 
                    isAudioEnabled ? 'Mute Audio' : 'Unmute Audio';
            }
        }

        // Hang up
        function hangUp() {
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            localVideo.srcObject = null;
            remoteVideo.srcObject = null;
            
            hangupBtn.disabled = true;
            roomInput.value = '';
            
            updateStatus('Call ended. Ready to start a new call.', 'info');
        }

        // Update status message
        function updateStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            if (peerConnection) {
                peerConnection.close();
            }
        });
    </script>
</body>
</html>
